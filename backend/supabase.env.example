# ===================================
# Supabase Configuration Example
# ===================================
# Copy this file to .env or config.env and update with your Supabase credentials
# Get these values from: Supabase Dashboard > Project Settings > Database

# Database Provider - MUST be set to "supabase"
DB_PROVIDER=supabase

# ===================================
# Option 1: Connection URL (RECOMMENDED)
# ===================================
# Get this from: Project Settings > Database > Connection String > URI
# Make sure to replace [YOUR-PASSWORD] with your actual database password

# RECOMMENDED: Use pooled connection for BOTH app and migrations
# This single connection works for everything - no need for a separate migration connection!
DATABASE_URL=postgresql://postgres.xxxxxxxxxxxx:[YOUR-PASSWORD]@aws-0-us-east-1.pooler.supabase.com:6543/postgres

# ALTERNATIVE: Direct connection (only use if you have specific issues with pooled connection)
# Not recommended - use pooled connection above instead
# DATABASE_URL=postgresql://postgres:[YOUR-PASSWORD]@db.xxxxxxxxxxxx.supabase.co:5432/postgres

# ===================================
# Option 2: Individual Parameters
# ===================================
# ALTERNATIVE: Use individual parameters instead of DATABASE_URL
# (Only use this if you prefer not to use DATABASE_URL above)

# RECOMMENDED: Pooled Connection (Port 6543)
# Use these settings for both your app AND migrations
# DB_HOST=aws-0-us-east-1.pooler.supabase.com
# DB_PORT=6543
# DB_USER=postgres.xxxxxxxxxxxx
# DB_PASSWORD=your-supabase-password
# DB_NAME=postgres
# DB_SSLMODE=require

# ALTERNATIVE: Direct Connection (Port 5432)
# Only use if you have issues with the pooled connection
# DB_HOST=db.xxxxxxxxxxxx.supabase.co
# DB_PORT=5432
# DB_USER=postgres
# DB_PASSWORD=your-supabase-password
# DB_NAME=postgres
# DB_SSLMODE=require

# ===================================
# Connection Pool Configuration
# ===================================
# These settings optimize connection usage with Supabase
# Adjust based on your Supabase plan limits

# Maximum number of open connections
# Free tier: max 60 connections, use 25-30
# Pro tier: max 200 connections, use 50-100
DB_MAX_OPEN_CONNS=25

# Maximum number of idle connections in the pool
DB_MAX_IDLE_CONNS=5

# Maximum lifetime of a connection (seconds)
# Recommended: 300 seconds (5 minutes)
DB_CONN_MAX_LIFETIME=300

# Maximum idle time for a connection (seconds)
# Recommended: 60 seconds (1 minute)
DB_CONN_MAX_IDLE_TIME=60

# ===================================
# Supabase Pooler Mode
# ===================================
# Available modes:
# - transaction: Best for serverless/edge functions (default)
# - session: Use when you need prepared statements or session-level features
# - statement: Most aggressive pooling, use for very high connection counts
SUPABASE_POOLER_MODE=transaction

# ===================================
# Server Configuration
# ===================================
PORT=8080
GIN_MODE=release

# ===================================
# Flyway Migration Configuration
# ===================================
FLYWAY_LOCATIONS=./flyway_migrations

# ===================================
# External Services
# ===================================
HUGGINGFACE_API_KEY=your-huggingface-api-key-here

# ===================================
# Optional Configuration
# ===================================
LOG_LEVEL=info
# JWT_SECRET=your-jwt-secret-here
# API_KEY_SECRET=your-api-key-secret-here

# ===================================
# CORS Configuration (if needed)
# ===================================
# CORS_ALLOWED_ORIGINS=https://your-app.com
# CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
# CORS_ALLOWED_HEADERS=Origin,Content-Type,Accept,Authorization

# ===================================
# Quick Setup Guide
# ===================================
# 1. Go to your Supabase project dashboard
# 2. Navigate to: Project Settings > Database
# 3. Find "Connection string" section
# 4. Under "Connection pooling", copy the "URI" (Transaction mode) connection string
#    Example: postgresql://postgres.xxx:[YOUR-PASSWORD]@aws-0-us-east-1.pooler.supabase.com:6543/postgres
# 5. Replace [YOUR-PASSWORD] with your database password
# 6. Paste it into DATABASE_URL above
# 7. Set DB_PROVIDER=supabase
# 8. Run your application!
#
# Note: Your database password is the one you set when creating the project,
# NOT your Supabase account password.

# ===================================
# FAQ: Do I need two connection strings?
# ===================================
# Q: Do I need separate connections for my app and migrations?
# A: NO! Use the SAME pooled connection (port 6543) for everything.
#
# Q: When should I use the direct connection (port 5432)?
# A: Only if you encounter specific issues with the pooled connection, such as:
#    - Need for long-running transactions (>60 seconds)
#    - Using PostgreSQL features not supported by the pooler
#    - Debugging connection pooler issues
#
# Q: Which connection string should I use from Supabase?
# A: Use the "Connection pooling" URI (port 6543) from:
#    Project Settings > Database > Connection String > Connection pooling > URI
#
# Q: What about the "Direct connection" string in Supabase?
# A: You typically don't need it. The pooled connection works for 99% of use cases.

